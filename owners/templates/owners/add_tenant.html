{% extends "rent/base_owner.html" %}
{% load static %}

{% block title %}Add Tenant | Rental Manago{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Add Tenant</h1>
</div>

<div class="card-style form-container-centered small-width">
    <form method="POST" class="modern-form">
        {% csrf_token %}

        <div class="form-group">
            <label>Full Name</label>
            <input type="text" name="name" placeholder="Full Name"
                   value="{{ form_data.name }}"
                   class="{% if errors.name %}input-error{% endif %}">
            {% if errors.name %}<p class="error-text">{{ errors.name }}</p>{% endif %}
        </div>

        <div class="form-group">
            <label>Mobile Number</label>
            <input type="text" name="mobile" placeholder="+91 98765 43210"
                   value="{{ form_data.mobile }}"
                   class="{% if errors.mobile %}input-error{% endif %}">
            {% if errors.mobile %}<p class="error-text">{{ errors.mobile }}</p>{% endif %}
        </div>

        <div class="form-group">
            <label>Rent Amount</label>
            <input type="number" name="amount" placeholder="₹ Amount"
                   value="{{ form_data.amount }}"
                   class="{% if errors.amount %}input-error{% endif %}">
            {% if errors.amount %}<p class="error-text">{{ errors.amount }}</p>{% endif %}
        </div>

        <div class="form-group">
            <label>Security Deposit</label>
            <input type="number" name="security_deposit" step="0.01" min="0"
                   placeholder="₹ Deposit (Optional)"
                   value="{{ form_data.security_deposit|default:'0.00' }}"
                   class="{% if errors.security_deposit %}input-error{% endif %}">
            {% if errors.security_deposit %}<p class="error-text">{{ errors.security_deposit }}</p>{% endif %}
        </div>

        <div class="form-group">
            <label>Rent Collection Type</label>
            <select name="due_type" id="dueTypeSelect"
                    class="{% if errors.due_type %}input-error{% endif %}">
                <option value="fixed" {% if form_data.due_type == 'fixed' %}selected{% endif %}>Fixed Monthly Date</option>
                <option value="cycle" {% if form_data.due_type == 'cycle' %}selected{% endif %}>30 Days Cycle</option>
            </select>
        </div>

        <div class="form-group" id="fixedDateBox">
            <label id="dateLabel">Lease Start Date</label>
            <input type="date" name="due_date"
                   value="{{ form_data.due_date }}"
                   class="{% if errors.due_date %}input-error{% endif %}">
            {% if errors.due_date %}<p class="error-text">{{ errors.due_date }}</p>{% endif %}
        </div>

        <div class="form-actions-full">
            <button type="submit" class="btn-primary btn-block">Submit</button>
            <button type="button" class="btn-text" id="backBtn">Back to List</button>
        </div>
    </form>
</div>

<script>
    const dueTypeSelect = document.getElementById("dueTypeSelect");
    const fixedDateBox = document.getElementById("fixedDateBox");
    const dateLabel = document.getElementById("dateLabel");

    function updateFormUI() {
        if (dueTypeSelect.value === "cycle") {
            // In a 30-day cycle, the date usually represents the start date
            dateLabel.innerText = "Cycle Start Date";
            fixedDateBox.style.display = "block"; 
        } else {
            dateLabel.innerText = "Monthly Due Date";
            fixedDateBox.style.display = "block";
        }
    }

    dueTypeSelect.addEventListener("change", updateFormUI);
    window.onload = updateFormUI;

    document.getElementById("backBtn").onclick = function() {
        window.location.href = "{% url 'owners:tenant_list' %}";
    };
</script>
{% endblock %}